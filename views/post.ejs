<%- include('partials/header') -%>
<main class="main-grid-container">
  <%- include('partials/nav') -%>
  <section class="grid-item">
    <h1>Speck</h1>
    <div class="post">
      <h2 data-id="<%= post._id %>"><%= post.title %></h2>
      <p class="post-content"><%= post.content %></p>
      <!-- If image exists, show image -->
      <% if(post.image) { %>
      <div class="image-container">
        <img class="post-image" src="<%= post.image%>" alt="image" />
      </div>
      <% } %>
      <p>
        By <span class="author"><%= post.author %></span> - <%= post.createdAt ?
        post.createdAt.toDateString() : 'Unknown Date' %>
      </p>

      <div class="edit-del-btns">
        <% if(user && String(post.userId) === user.id) { %>

        <a class="submit-btns" href="/posts/edit/<%= post._id %>">Edit</a>

        <% } %> <% if(user && String(post.userId) === user.id) { %>
        <form action="/posts/<%= post._id %>?_method=DELETE" method="POST">
          <button class="delete-btns" type="submit">Delete</button>
        </form>
        <% } %>
      </div>
    </div>
    <!-- Lightbox modal -->
    <div
      id="lightbox"
      class="lightbox hidden"
      role="dialog"
      aria-modal="true"
      aria-label="Image viewer"
      tabindex="-1">
      <button class="lightbox__close" aria-label="Close">&times;</button>
      <img id="lightbox-image" alt="" />
    </div>
    <a class="submit-btns" href="/posts">Back</a>
  </section>
</main>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const lightbox = document.getElementById("lightbox");
    const lightboxImg = document.getElementById("lightbox-image");
    const closeBtn = document.querySelector(".lightbox__close");

    // Open when clicking any post image
    document.querySelectorAll(".post-image").forEach((img) => {
      img.addEventListener("click", () => {
        lightboxImg.src = img.src;
        lightboxImg.alt = img.alt || "";
        lightbox.classList.remove("hidden");
        document.body.style.overflow = "hidden"; // prevent background scroll
        lightbox.focus();
      });
    });

    const closeLightbox = () => {
      lightbox.classList.add("hidden");
      lightboxImg.src = "";
      document.body.style.overflow = "";
    };

    // Close on X button
    closeBtn.addEventListener("click", closeLightbox);

    // Close when clicking the overlay (but not the image)
    lightbox.addEventListener("click", (e) => {
      if (e.target === lightbox) closeLightbox();
    });

    // Close on Escape
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && !lightbox.classList.contains("hidden")) {
        closeLightbox();
      }
    });
  });
</script>
<%- include('partials/footer') -%>
